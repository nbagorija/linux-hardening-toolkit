# Hardened Audit Rules
# Based on CIS Benchmarks
# Copy to /etc/audit/rules.d/hardened.rules

# Delete all existing rules
-D

# Buffer size
-b 8192

# Failure mode (1=printk, 2=panic)
-f 1

# ===== Identity Changes =====
-w /etc/passwd -p wa -k identity
-w /etc/shadow -p wa -k identity
-w /etc/group -p wa -k identity
-w /etc/gshadow -p wa -k identity
-w /etc/security/opasswd -p wa -k identity

# ===== Sudo =====
-w /etc/sudoers -p wa -k sudoers
-w /etc/sudoers.d/ -p wa -k sudoers

# ===== Login Monitoring =====
-w /var/log/faillog -p wa -k logins
-w /var/log/lastlog -p wa -k logins
-w /var/log/wtmp -p wa -k logins
-w /var/log/btmp -p wa -k logins

# ===== Session Monitoring =====
-w /var/run/utmp -p wa -k session

# ===== Network Configuration =====
-w /etc/hosts -p wa -k network
-w /etc/network/ -p wa -k network
-w /etc/sysctl.conf -p wa -k network
-w /etc/sysctl.d/ -p wa -k network

# ===== Cron =====
-w /etc/crontab -p wa -k cron
-w /etc/cron.d/ -p wa -k cron
-w /etc/cron.daily/ -p wa -k cron
-w /etc/cron.hourly/ -p wa -k cron
-w /etc/cron.weekly/ -p wa -k cron
-w /etc/cron.monthly/ -p wa -k cron

# ===== SSH =====
-w /etc/ssh/sshd_config -p wa -k sshd

# ===== System Startup =====
-w /etc/init.d/ -p wa -k init
-w /etc/systemd/ -p wa -k systemd

# ===== Kernel Modules =====
-w /sbin/insmod -p x -k modules
-w /sbin/rmmod -p x -k modules
-w /sbin/modprobe -p x -k modules

# ===== Time Changes =====
-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change
-w /etc/localtime -p wa -k time-change

# ===== Make rules immutable (must be last) =====
# -e 2
